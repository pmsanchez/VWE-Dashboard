<div class="students-manager-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="component-title">Student Manager</h2>
        <button class="btn btn-tab active" (click)="fetchSeminars()">ðŸ”„ Refresh Data</button> 
    </div>

    <div class="card bg-lighter-card p-4 shadow-sm content-display">
        
        <div class="seminar-selection mb-4">
            <h3 class="text-primary mb-3">Select Seminar</h3>
            
            <div *ngIf="isLoadingSeminars" class="alert alert-info">Loading seminar options...</div>
            <div *ngIf="seminarErrorMessage" class="alert alert-danger">{{ seminarErrorMessage }}</div>

            <select 
                class="form-select form-control-lg" 
                [(ngModel)]="selectedSeminarId" 
                (change)="onSeminarChange()"
                *ngIf="!isLoadingSeminars && !seminarErrorMessage"
                [disabled]="isLoadingSeminars"
            >
                <option *ngIf="selectedSeminarId === null" [ngValue]="null" disabled>
                    -- Select a Seminar --
                </option>

                <option *ngFor="let seminar of seminars" [ngValue]="convertToString(seminar.id)">
                    {{ seminar.name }}
                </option>
            </select>
        </div>

        <div class="seminar-details-box mb-4" *ngIf="selectedSeminarDetails">
            <h4 class="text-secondary mb-3">Seminar Details</h4>
            <div class="details-grid">
                <div class="detail-item">
                    <label class="text-muted">Name:</label>
                    <p class="mb-0 text-primary">{{ selectedSeminarDetails.name }}</p>
                </div>
<div class="details-grid">
    <div class="detail-item">
        <label class="text-muted">Location:</label>
        <p class="mb-0">
            {{ selectedSeminarDetails.location_name }} 
            <span class="text-muted small">({{ selectedSeminarDetails.location_country_code }})</span>
        </p>
    </div>
    </div>
                <div class="detail-item">
                    <label class="text-muted">Start Date:</label>
                    <p class="mb-0">{{ selectedSeminarDetails.start_date | date }}</p>
                </div>
                <div class="detail-item">
                    <label class="text-muted">End Date:</label>
                    <p class="mb-0">{{ selectedSeminarDetails.end_date | date }}</p>
                </div>
            </div>
            <div class="mt-3">
                <label class="text-muted">Description:</label>
                <p class="small text-wrap">{{ selectedSeminarDetails.description || 'No description provided.' }}</p>
            </div>
        </div>
        <hr>

        <div class="student-list-view">
            <h3 class="text-secondary mb-4">Students List</h3> 

            <div *ngIf="selectedSeminarId === null && !isLoadingSeminars" class="alert alert-warning text-center">
                Please select a seminar from the dropdown above to view students.
            </div>

            <div *ngIf="isLoadingStudents" class="alert alert-info text-center">
                Loading students for the selected seminar...
            </div>

            <div *ngIf="studentsErrorMessage" class="alert alert-danger">
                Error: {{ studentsErrorMessage }}
            </div>

            <div *ngIf="!isLoadingStudents && !studentsErrorMessage && students.length === 0 && selectedSeminarId !== null" 
                    class="alert alert-warning text-center">
                No students found for this seminar.
            </div>

            <div class="table-responsive" *ngIf="students.length > 0">
                <table class="table table-striped table-hover receipt-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Student ID</th>
                            <th>Email</th>
                            <th>T-Shirt/Hoodie</th>
                            <th>Allergies</th>
                            <th>City</th>
                            <th>Phone</th>
                            <th>Attendance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let student of paginatedStudents">
                            <td>{{ student.name }}</td>
                            <td>{{ student.stud_id || 'N/A' }}</td>
                            <td>{{ student.email || 'N/A' }}</td>
                            <td>{{ student.tshirt_size }} / {{ student.hoodie_size }}</td>
                            <td>
                                <span [class]="student.food_allergies ? 'text-danger' : 'text-success'">
                                    {{ student.food_allergies ? 'YES' : 'No' }}
                                </span>
                                <span *ngIf="student.allergy_details" class="text-muted small d-block">
                                    ({{ student.allergy_details }})
                                </span>
                            </td>
                            <td>{{ student.city }}, {{ student.country_code }}</td>
                            <td>{{ student.phone }}</td>
                            <td>{{ student.seminar_attendances || 0 }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <nav *ngIf="totalPages > 1" aria-label="Student Pagination">
    <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)">Previous</a>
        </li>
        
        <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" 
            [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
        </li>
    </ul>
</nav>
            
        </div>

    </div>
</div>